{% extends "base.html" %}

{% block body %}
<!-- https://github.com/davidmerfield/randomColor provides an awesome color randomizer with lots of awesome options!-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.5.2/randomColor.min.js"></script> -->
<div style="resize: vertical; overflow:auto; display:block; height:calc(35vh); margin-top:5px" class="card border-dark bg-card-body" id="callback_table">
    <div class="card-header bg-header text-white" style="margin:0">
        <span><h4 style="display:inline-block">Current <span class="operator">Callbacks</span></h4></span>
        <span style="display:inline-block; float:right">
            <span class="input-group" >
            <input type="text" size="50rem" placeholder="filter with 'property:value'" id="filter" v-model="filter">
            <div class="input-group-append input-group-btn" ><button disabled type="button" class="btn btn{{config['outline-buttons']}}secondary"><i class="fa fa-filter"></i></button></div>
            </span>
        </span>
    </div>
        <table class="table table-striped {{config['table-color']}} table-hover border border-dark shadow table-condensed" style="padding:0;margin:0;">
            <tr class="sticky-top">
                <th class="sticky-top"><input type="checkbox" @click="check_all_callbacks()" id="all_callback_checkbox"></th>
                <th @click="sort_callbacks('id')" class="sticky-top">
                    Callback <img v-if="sort == 'id' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'id'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('host')" class="sticky-top">
                    Host <img v-if="sort == 'host' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'host'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('ip')" class="sticky-top">
                    IP <img v-if="sort == 'ip' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'ip'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('user')" class="sticky-top">
                    User <img v-if="sort == 'user' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'user'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('domain')" class="sticky-top">
                    Domain <img v-if="sort == 'domain' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'domain'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('real_time')" class="sticky-top">
                    Last Checkin <img v-if="sort == 'real_time' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'real_time'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('os')" class="sticky-top">
                    OS (arch) <img v-if="sort == 'os' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'os'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('description')" class="sticky-top">
                    Description <img v-if="sort == 'description' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'description'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('pid')" class="sticky-top">
                    PID <img v-if="sort == 'pid' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'pid'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('init_callback')" class="sticky-top">
                    Initial Checkin <img v-if="sort == 'init_callback' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'init_callback'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
                <th @click="sort_callbacks('metadata')" class="sticky-top">
                    Metadata <img v-if="sort == 'metadata' && direction == 1" src="/static/color-arrow.png" style="width:32px;height:32px"><img v-else-if="sort == 'metadata'" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(180deg)">
                </th>
            </tr>
        <!-- Repeat this for each callback -->
            {% if config['new-callback-color'] == 'light' %}
            <tr v-for="callback in sorted_callbacks"  :style="!callback.selected ? '' : 'background-color:' + shadeBlend(0.4, callback.bg_color)" v-if="apply_filter(callback)">
            {% else %}
            <tr v-for="callback in sorted_callbacks" :class="callback.selected ? 'font-outline': ''" :style="!callback.selected ? '' : 'background-color:' + shadeBlend(.5, callback.bg_color)" v-if="apply_filter(callback)">
            {% endif %}
            <td style="padding:.4rem"><input type="checkbox" v-model="callback.selected"></td>
                <td >
                    <!-- Split button -->
                    <div class="btn-group dropdown" >
                        <template v-if="callback.integrity_level <= 2">
                            <button type="button" class="btn alert-primary btn-sm" @click="interact_button(callback)" style="padding:2px 2px 2px 2px">
                                <i :class="callback.locked ? 'fas fa-user-lock' : 'fas fa-keyboard'">&nbsp;</i><font size="3">
                                [[callback.id]]</font>
                            </button>
                              <button type="button" class="btn alert-primary dropdown-toggle btn-sm dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="caret"></span>
                              </button>
                        </template>
                        <template v-else>
                            <button type="button" class="btn alert-danger btn-sm" @click="interact_button(callback)" style="padding:2px 2px 2px 2px"> <i :class="callback.locked ? 'fas fa-user-lock' : 'fas fa-keyboard'">&nbsp;</i><font size="3">
                                [[callback.id]]</font></button>
                              <button type="button" class="btn alert-danger dropdown-toggle btn-sm dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="caret"></span>
                              </button>
                        </template>
                      <div class="dropdown-menu">
                          <a class="dropdown-item" @click="edit_description(callback)" href="#"><i class="fas fa-edit"></i> Description</a>
                          <a class="dropdown-item" @click="show_keylogs(callback)" href="#"><i class="fas fa-pencil-alt"></i>&nbsp; Keylogs</a>
                          <a class="dropdown-item" @click="show_screencaptures(callback)" href="#"><i class="fas fa-camera"></i>&nbsp;Screencaptures</a>
                          <div class="dropdown-divider"></div>
                          <a class="dropdown-item" @click="split_callback(callback)" href="#"><i class="fas fa-external-link-alt"></i>&nbsp;Expand Callback</a>
                          <a class="dropdown-item" @click="view_loaded_commands(callback)" href="#"><i class="fas fa-eye"></i> Loaded Commands</a>
                          <a class="dropdown-item" @click="show_process_list(callback)" href="#"><i class="fas fa-list"></i>&nbsp;Processes</a>
                          <template v-if="callback.locked">
                            <a class="dropdown-item" @click="toggle_lock(callback)" href="#"><i class="fas fa-lock-open"></i> Locked by [[callback.locked_operator]]</a>
                          </template>
                          <template v-else>
                            <a class="dropdown-item" @click="toggle_lock(callback)" href="#"><i class="fas fa-lock"></i> Lock</a>
                          </template>
                          <div class="dropdown-divider"></div>
                          <a class="dropdown-item" @click="exit_callback(callback)" href="#"><i class="fas fa-skull-crossbones"></i>&nbsp; Exit Callback</a>
                          <a class="dropdown-item" @click="remove_callback(callback)" href="#"><i class="fas fa-eye-slash"></i>&nbsp; Hide Callback</a>
                      </div>
                    </div>
                </td>
                <td >[[ callback.host ]]</td>
                <td >
                    <template v-if="callback.external_ip != null && callback.external_ip != ''">
                        Ext: [[ callback.external_ip ]]<br>
                        Int: [[ callback.ip   ]]
                    </template>
                    <template v-else>
                        [[callback.ip]]
                    </template>
                </td>
                <td >[[ callback.user ]]</td>
                <td >[[ callback.domain ]] </td>
                <td >[[ timeConversion(callback.real_time) ]]</td>
                <td >[[ callback.os]] ([[callback.architecture]])</td>
                <td >[[ callback.description]]</td>
                <td >[[ callback.pid  ]]</td>
                <td >[[ toLocalTime(callback.init_callback) ]]</td>
                <td >[[ callback.payload_type ]]<br>[[ callback.c2_profile ]]</td>
        </tr>
        <!-- End of the repeating -->
        </table>
</div>
<div class="card" id="bottom-data">
    <!-- Tabs at the bottom of the screen - just the names at the top though-->
    <ul class="nav nav-tabs" role="tablist" id="bottom-tabs">
        {% if config['new-callback-color'] == 'light' %}
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.tasks" role="button" key="metadata.id" style="position:relative">
            <template v-if="metadata.payload_description == metadata.description">
                <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'nav-link' " :id="'tasks' + metadata.id + 'tab'" :href="'#tasks' + metadata.id" :aria-controls="'tasks' + metadata.id" :style="!metadata.selected ? '': 'font-weight:bold;color:black;background-color:' + shadeBlend(0.2, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)"><template v-if="metadata.badges > 0"><span style="padding:5px 10px 5px 10px" class="badge badge-danger pull-right">[[metadata.badges]]</span></template>[[metadata.display]] <span class="btn btn-sm btn{{config['outline-buttons']}}danger" @click="console_tab_close(metadata)">X</span></a>
            </template>
            <template v-else>
                <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'nav-link' " :id="'tasks' + metadata.id + 'tab'" :href="'#tasks' + metadata.id" :aria-controls="'tasks' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:black;background-color:' + shadeBlend(0.2, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">[[metadata.description]] <span class="btn btn-sm btn{{config['outline-buttons']}}danger" @click="console_tab_close(metadata)">X</span></a>
            </template>
        </li>
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.screencaptures" role="button" key="metadata.id">
            <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'nav-link' " :id="'screencaptures' + metadata.id + 'tab'" :href="'#screencaptures' + metadata.id" :aria-controls="'screencaptures' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:black;background-color:' + shadeBlend(0.2, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">Screencaptures [[metadata.id]]<span class="btn btn-sm btn{{config['outline-buttons']}}danger" @click="screencaptures_tab_close(metadata)">X</span></a>
        </li>
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.keylogs" role="button" key="metadata.id">
            <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'nav-link' " :id="'keylogs' + metadata.id + 'tab'" :href="'#keylogs' + metadata.id" :aria-controls="'keylogs' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:black;background-color:' + shadeBlend(0.2, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">Keylogs: [[metadata.display]]<span class="btn btn-sm btn{{config['outline-buttons']}}danger" @click="keylog_tab_close(metadata)">X</span></a>
        </li>
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.process_list" role="button" key="metadata.id">
            <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'nav-link' " :id="'process_list' + metadata.id + 'tab'" :href="'#process_list' + metadata.id" :aria-controls="'process_list' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:black;background-color:' + shadeBlend(0.2, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">Processes ([[metadata.host]]) - [[metadata.id]]<span class="btn btn-sm btn{{config['outline-buttons']}}danger" @click="process_list_tab_close(metadata)">X</span></a>
        </li>
        {% else %}
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.tasks" role="button" key="metadata.id" style="position:relative">
             <template v-if="metadata.payload_description == metadata.description">
                 <a :class="!metadata.selected ? 'nav-link bg-secondary text-white pull-left' : 'font-outline nav-link pull-left' " :id="'tasks' + metadata.id + 'tab'" :href="'#tasks' + metadata.id" :aria-controls="'tasks' + metadata.id" :style="!metadata.selected ? 'display:inline-block' : 'display:inline-block;font-weight:bold;color:white;background-color:' + shadeBlend(0.5, metadata.bg_color)" data-toggle="tab" @click="select_tab(metadata)"><template v-if="metadata.badges > 0"><span style="padding:5px 10px 5px 10px" class="badge badge-danger pull-right">[[metadata.badges]]</span></template>[[metadata.display]]
                     <span class="font-outline btn-sm btn{{config['outline-buttons']}}danger" @click="return console_tab_close(metadata)">X</span></a>
             </template>
            <template v-else>
                <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'font-outline nav-link' " :id="'tasks' + metadata.id + 'tab'" :href="'#tasks' + metadata.id" :aria-controls="'tasks' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:white;background-color:' + shadeBlend(0.5, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)"><template v-if="metadata.badges > 0"><span style="padding:5px 10px 5px 10px" class="badge badge-danger pull-right">[[metadata.badges]]</span></template>[[metadata.description]]
                    <span class="font-outline btn-sm btn{{config['outline-buttons']}}danger" @click="console_tab_close(metadata)" >X</span></a>
            </template>
        </li>
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.screencaptures" role="button" key="metadata.id">
            <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'font-outline nav-link' " :id="'screencaptures' + metadata.id + 'tab'" :href="'#screencaptures' + metadata.id" :aria-controls="'screencaptures' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:white;background-color:' + shadeBlend(0.5, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">Screencaptures [[metadata.id]]<span class="font-outline btn-sm btn{{config['outline-buttons']}}danger" @click="screencaptures_tab_close(metadata)">X</span></a>
        </li>
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.keylogs" role="button" key="metadata.id">
            <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'font-outline nav-link' " :id="'keylogs' + metadata.id + 'tab'" :href="'#keylogs' + metadata.id" :aria-controls="'keylogs' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:white;background-color:' + shadeBlend(0.5, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">Keylogs: [[metadata.display]]<span class="font-outline btn-sm btn{{config['outline-buttons']}}danger" @click="keylog_tab_close(metadata)">X</span></a>
        </li>
        <li class="nav-item" v-for="metadata in meta" v-if="metadata.process_list" role="button" key="metadata.id">
            <a :class="!metadata.selected ? 'nav-link bg-secondary text-white' : 'font-outline nav-link' " :id="'process_list' + metadata.id + 'tab'" :href="'#process_list' + metadata.id" :aria-controls="'process_list' + metadata.id" :style="!metadata.selected ? '' : 'font-weight:bold;color:white;background-color:' + shadeBlend(0.5, metadata.bg_color)" role="button" data-toggle="tab" @click="select_tab(metadata)">Processes ([[metadata.host]]) - [[metadata.id]]<span class="font-outline btn-sm btn{{config['outline-buttons']}}danger" @click="process_list_tab_close(metadata)">X</span></a>
        </li>
        {% endif %}
    </ul>
    <!-- Now actually deal with the content in each tab-->
    <div class="tab-content bg-card-body" id="bottom-tabs-content" style="overflow:scroll;resize:vertical;height: calc(49vh);">
        <!-- REPEAT for each task for the specific callback that's selected -->
        <div v-for="metadata in meta" role="tabpanel" class="tab-pane" v-if="metadata.tasks" :id="'tasks' + metadata.id"  >
            <div :id="'tasks' + metadata.id + 'data'" >
                <div class="card bg-header-dark border-dark " v-for="task in metadata.data" :key="task.id" :id="'task' + task.id" style="word-wrap: break-word;margin:3px">
                    <div class="card-header border border-dark shadow bg-header-dark" style="position:-webkit-sticky;position:sticky;top:0;padding-bottom:0;padding-top:10px">
                        <template v-if="task.comment != ''">
                            <button class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="remove_comment(task.id)" style="padding:0px 4px;"><i class="fas fa-trash-alt"></i></button><span class="operator"> [[task.comment_operator]]</span>'s comment: [[task.comment]]<br><hr>
                        </template>
                        <template v-if="task.completed == true && task.status != 'error'">
                            <button disabled class="btn btn{{config['outline-buttons']}}success btn-sm" >completed</button>
                        </template>
                        <template v-else-if="task.status == 'processed'">
                            <button disabled class="btn btn{{config['outline-buttons']}}primary btn-sm" >[[task.status]]</button>
                        </template>
                        <template v-else-if="task.status == 'processing'">
                            <button disabled class="btn btn{{config['outline-buttons']}}warning btn-sm" >[[task.status]]</button>
                        </template>
                        <template v-else-if="task.status == 'error'">
                            <button disabled class="btn btn{{config['outline-buttons']}}danger btn-sm" >[[task.status]]</button>
                        </template>
                        <template v-else>
                            <button disabled class="btn btn{{config['outline-buttons']}}info btn-sm" >[[task.status]]</button>
                        </template>
                        &nbsp;
                        <span class="operator">[[task.operator]]</span>'s task: <a :href="task.href" target="_blank" data-toggle="tooltip" title="View task and output and separate window"><b>[[task.id]]</b></a> <button style="border:0" class="btn btn-sm btn{{config['outline-buttons']}}success" @click="add_comment(task)"><i class="fas fa-comments fa-lg" data-toggle="tooltip" title="Add comment to task"></i></button>&nbsp;&nbsp;<span class="material-switch pull-right" data-toggle="tooltip" title="Toggle application of browser scripts to output of this task"><input :id="'use_scripted' + task.id" type="checkbox" :checked="task.use_scripted" v-model="task.use_scripted"><label :for="'use_scripted' + task.id" class="btn-info"></label></span><button class="btn btn-sm" style="color:green" data-toggle="tooltip" title="download raw output" @click="download_raw_output(task.id)" ><i class="fas fa-save fa-lg" ></i></button>- at <span class="timestamp">[[toLocalTime(task.timestamp)]]</span>: <a class="btn btn-link" type="button" data-toggle="collapse" :data-target="'#cardbody' + task.id" aria-expanded="false" :aria-controls="'cardbody' + task.id" @click="toggle_arrow(task.id)"><img :id="'color-arrow' + task.id" src="/static/color-arrow.png" style="width:32px;height:32px;transform:rotate(0deg)" data-toggle="tooltip" title="view / hide task output"> <b>[[task.command]]&nbsp;</b>[[task.original_params]]</a><button class="btn btn-sm" style="color:{{config['text-color']}}" data-toggle="tooltip" title="Copy command to clipboard" @click="copyStringToClipboard(task.command + ' ' + task.original_params)" ><i class="far fa-copy" ></i></button>
                    </div>
                    <div class="collapse" :id="'cardbody' + task.id" >
                        <div class="response-background card-body border border-dark shadow" >
                            <template v-if="task.params != task.original_params">
                                <button class="btn btn{{config['outline-buttons']}}info btn-sm" :id="'toggle_task' + task.id" @click="toggle_show_params(task.id)"><i class="fas fa-eye"></i> params</button><span class="response" style="display:none">&nbsp;&nbsp;[[task.params]]</span><br>
                            </template>
                            <template v-if="task.hasOwnProperty('scripted') && task.use_scripted">
                                <span v-html="task.scripted"></span>
                            </template>
                            <template v-else>
                                <span class="card-text" v-for="rsp in task.response" :key="rsp.id" :id="'response' + rsp.id" style="white-space: pre-wrap"><span class="timestamp">([[toLocalTime(rsp.timestamp)]])</span><br><span class="response"><pre>[[rsp.response]]</pre></span></span>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END REPEAT-->
        <!-- REPEAT FOR SCREENCAPTURE INFORMATION -->
        <div v-for="metadata in meta" role="tabpanel" class="tab-pane" v-if="metadata.screencaptures" :id="'screencaptures' + metadata.id">
            <div  :id="'screencaptures' + metadata.id + 'view'">
                <div v-for="image,i in metadata.images" :key="image.id">
                    <button :id='image.remote_path' class="accordion bg-card-body-l2 text-white border border-dark shadow" style="cursor: pointer;padding: 18px;width: 100%;text-align: left;border: none; outline: none;transition: 0.4s;margin-bottom:10px" @click="toggle_image(image)"><span class="operator">[[image.operator]]</span>'s screencapture at <span class="timestamp">[[image.path.split("/").slice(-1).toString()]]</span></button>
                      <img :src='image.remote_path' width="100%" height="100%" style="display:none">
                </div>
            </div>
        </div>
        <!-- END REPEAT-->
        <!-- REPEAT FOR KEYLOG INFORMATION -->
        <div v-for="metadata in meta" role="tabpanel" class="tab-pane" v-if="metadata.keylogs" :id="'keylogs' + metadata.id">
            <div  :id="'keylogs' + metadata.id + 'view'">
                <div v-for="(data, window, i) in metadata.keylog_data" class="card bg-card-body-l1 border border-dark shadow" style="margin:10px">
                    <div class="card-header border border-dark bg-header-dark shadow">
                        <button class="btn btn-md btn{{config['outline-buttons']}}info" style="border:0" @click="toggle_keylog_times(metadata)">
                                <i class="fas fa-clock fa-lg"></i>
                        </button> Window: <b><span class="operator"><a class="btn" type="button" data-toggle="collapse" :data-target="'#window' + i" aria-expanded="false" :aria-controls="'window' + i">[[window]]</a></span></b>
                    </div>
                    <div class="collapse" :id="'window' + i">
                        <div class="card-body bg-card-body-l2 border border-dark shadow">
                            <template v-if="metadata.keylog_time">
                                 <template v-for="entry in data">
                                    <span class="timestamp">([[toLocalTime(entry.timestamp)]])</span>
                                    <pre>[[entry.keystrokes]]</pre>
                                 </template>
                            </template>
                            <template v-else>
                                <pre><template v-for="entry in data">[[entry.keystrokes]]</template></pre>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END REPEAT-->
        <!-- REPEAT FOR PROCESS LIST INFORMATION -->
        <div v-for="metadata in meta" role="tabpanel" class="tab-pane" v-if="metadata.process_list" :id="'process_list' + metadata.id">
            <span style="display:inline-block;width:25%;height: calc(45vh);overflow-y:scroll">
                <div class="card border border-dark shadow bg-card-body-l1"  v-if="metadata.hasOwnProperty('process_list_tree')">
                   <tree-menu v-for="v in metadata.process_list_tree"
                     :children="v.children"
                     :depth="0"
                     :process_id="v.process_id"
                     :bin_path="v.name"
                     :callback_pid="callbacks[metadata.id]['pid']"
                     >
                   </tree-menu>
                </div>
            </span>
            <span style="display:inline-block;width:75%;margin:0;padding:0;height: calc(45vh);overflow-y:scroll;float:right">
                <table class="table table-striped table-hover {{config['table-color']}} table-condensed bg-card-body-l2 shadow border border-dark" style="white-space:nowrap;table-layout:fixed;overflow:scroll;">
                    <tr>
                        <template v-if="metadata.hasOwnProperty('process_list_data') && metadata['process_list_data'].hasOwnProperty('process_list') && metadata['process_list_data']['diff']">
                            <th onclick="sort_table(this)" class="sticky-top" style="width:6rem">Diff</th>
                        </template>
                        <th onclick="sort_table(this)" class="sticky-top" style="width:6rem"><b>PID</b></th>
                        <th onclick="sort_table(this)" class="sticky-top" style="width:6rem"><b>PPID</b></th>
                        <th onclick="sort_table(this)" class="sticky-top" style="width:20rem"><b>Name</b></th>
                        <th onclick="sort_table(this)" class="sticky-top" style="width:4rem"><b>Arch</b></th>
                        <th onclick="sort_table(this)" class="sticky-top" style="width:15rem"><b>User</b></th>
                        <th onclick="sort_table(this)" class="sticky-top"><b>BinPath</b></th>

                    </tr>
                    <template v-if="metadata.hasOwnProperty('process_list_data') && metadata['process_list_data'].hasOwnProperty('process_list')">
                        <tr v-for="proc in metadata['process_list_data']['process_list']" v-if="apply_process_filter(proc, metadata)" :style="proc.process_id == callbacks[metadata.id]['pid'] ? 'background-color: {{config['highlight']}};color: {{config['highlight-text']}}' : ''">
                            <template v-if="proc.hasOwnProperty('diff')">
                                <td v-if="proc['diff'] == 'add'">
                                    <font color="green"><i class="fas fa-plus"></i></font><font hidden class="bg-card-body-l2">add</font>
                                </td>
                                <td v-else-if="proc['diff'] == 'remove'">
                                    <font color="red"><i class="fas fa-minus-circle"></i></font><font hidden class="bg-card-body-l2">remove</font>
                                </td>
                                <td v-else>
                                </td>
                            </template>
                            <td>[[proc.process_id]]</td>
                            <td>[[proc.parent_process_id]]</td>
                            <td>[[proc.name]]</td>
                            <td>[[proc.architecture]]</td>
                            <td>[[proc.user]]</td>
                            <td>[[proc.bin_path]]</td>

                        </tr>
                    </template>
                </table>
            </span>
            <div class="bg-card-body-l1 sticky-bottom" style="margin-bottom:10px;overflow:scroll">
                <button class="btn btn-sm btn{{config['outline-buttons']}}warning" @click="task_list_processes(metadata)"><i class="fas fa-sync-alt"></i></button>
                <button class="btn btn-sm btn{{config['outline-buttons']}}info" @click="get_previous_process_list(metadata)"><i class="fas fa-backward"></i></button>
                <button class="btn btn-sm btn{{config['outline-buttons']}}info" @click="get_next_process_list(metadata)"><i class="fas fa-forward"></i></button>
                <button class="btn btn-sm btn{{config['outline-buttons']}}success" @click="diff_process_list(metadata)">Diff Previous</button>
                <template v-if="metadata.hasOwnProperty('process_list_data') && metadata['process_list_data'].hasOwnProperty('process_list')" class="sticky-bottom">
                    Current listing from Task <a :href="'{{http}}://{{links.server_ip}}:{{links.server_port}}/tasks/' + metadata['process_list_data']['task']" target="_blank"><b>[[ metadata['process_list_data']['task'] ]]</b></a> Callback [[ metadata['process_list_data']['callback'] ]] at <span class="timestamp">[[ toLocalTime(metadata['process_list_data']['timestamp']) ]]</span>
                    <span style="display:inline-block; float:right">
                        <span class="input-group" >
                        <input type="text" size="50rem" placeholder="filter with 'property:value'" v-model="metadata.process_list_filter">
                        <div class="input-group-append input-group-btn" ><button disabled type="button" class="btn btn{{config['outline-buttons']}}secondary"><i class="fa fa-filter"></i></button></div>
                        </span>
                    </span>
                </template>
            </div>
        </div>
        <!-- END REPEAT-->
    </div>
    <div class="card-footer border border-dark" style="margin:0;padding:5px" id="panel-footer-input-group">
        <div class="input-group" style="margin:0!important;padding:5px">

            <input id="commandline" type="text" class="form-control" v-model="input_field"
                   :placeholder="input_field_placeholder.data" aria-describedby="basic-addon1"
                   @keydown.enter="task_button(input_field_placeholder)" @keyup.up="cmd_history_up(input_field_placeholder)" @keyup.down="cmd_history_down(input_field_placeholder)"
                   autocomplete="off" style="height:calc(3rem)"
            >
            <div class="input-group-append">
                <button type="button" class="btn btn{{config['outline-buttons']}}danger" @click="task_button(input_field_placeholder)" >Submit Task</button>
                <button type="button" data-toggle="modal" data-target="#editCommandSwitches" type="button" href="#" class="btn btn-sm btn-outline-primary" :style="!taskable ? 'pointer-events: none;' : ''" ><font :color="hasTransformsSet ? '#ffc107' : '#C0C0C0'"><i class="fas fa-cogs fa-2x"></i></font></button>
            </div>
        </div>
    </div>
    <!-- START POPOVER FOR EDITING RUNNING COMMAND TRANSFORMS -->
    <div id="editCommandSwitches" class="modal fade" role="dialog">
         <div class="modal-dialog modal-md" role="document">
             <div class="modal-content">
                 <div class="modal-header bg-dark text-white">
                <h3>Command Transforms</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
             <div class="modal-body">
                 Changes are temporary unless you persist them across the operation
                <table v-if="get_payload_type != null && get_cmd_index != -1" class="table-striped {{config['table-color']}} table-hover" style="width:100%">

                    <tr>
                        <th >Order</th>
                        <th>Transform</th>
                        <th>Active?</th>
                    </tr>
                    <tr v-for="(t, i) in ptype_cmd_params[get_payload_type][get_cmd_index]['transforms']" :key="t.order">
                        <td>[[t.order]]</td>
                        <td>[[t.name]]&nbsp;</td>
                        <td><span class="material-switch pull-right"><input type="checkbox" :checked="t.active" v-model="t.active" :id="'active_transform' + t.id"><label :for="'active_transform' + t.id" class="btn-info"></label></span></td>
                    </tr>
                    <tr>
                        <td>
                            <button type="button" class="btn btn{{config['outline-buttons']}}success" data-dismiss="modal" @click="persist_transform_active_status(get_payload_type, get_cmd_index)">Persist</button>
                        </td>
                        <td style="padding: 10px">
                            <p>Test command?</p>
                        </td>
                        <td>
                            <span class="material-switch pull-right"><input type="checkbox" :checked="test_command" v-model="test_command" id="test_command_transform"><label for="test_command_transform" class="btn-info"></label></span>
                        </td>
                    </tr>
                </table>
             </div>
             <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}success" data-dismiss="modal" aria-hidden="true">Close</button>
            </div>
             </div>
         </div>
    </div>
    <!-- END POPOVER FOR EDITING RUNNING COMMAND TRANSFORMS -->
</div>

<!-- THIS IS OUR MODAL FOR VIEW_LOADED_COMMANDS -->
<div class="modal fade" id="loadedCommandModal" role="dialog" >
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Currently Loaded Commands</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body">
                <table class="table table-striped {{config['table-color']}} table-hover">
                  <tr><th><b>Command Name</b></th>
                      <th><b>Loaded Version</b></th>
                      <th><b>Apfell Version</b></th>
                  </tr>
                  <tr v-for="c in loaded_commands" :key="c.id" :style="c.version != c.apfell_version ? 'background-color:{{config.failure_highlight}}' : ''">
                      <td>[[c.command]]</td>
                      <td>[[c.version]]</td>
                      <td>[[c.apfell_version]]</td>
                  </tr>
              </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}success" data-dismiss="modal" aria-hidden="true">OK</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR VIEW LOADED COMMANDS -->
<!-- THIS IS OUR MODAL FOR ADDING A COMMENT -->
<div class="modal fade" id="addCommentModal" role="dialog" >
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Add / Edit Comment</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body">
                <textarea rows="5" cols="50" id="addCommentTextArea"></textarea>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}success" data-dismiss="modal" id="addCommentSubmit" aria-hidden="true">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR ADDING A COMMENT -->
<!-- THIS IS OUR MODEL FOR PROMPTING FOR COMMAND PARAMETERS -->
<div class="modal fade" id="paramsModal" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3 id="paramsModalHeader">Command Parameters</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body" id="paramsBody">
                  <p>A * indicates a required parameter</p>
                <table id="paramsTable" class="table-striped {{config['table-color']}} table-hover" style="width:100%">
                    <tr>
                        <th style="padding:10px;margin:10px">Parameter</th>
                        <th>Value</th>
                    </tr>
                    <tr v-for="param in command_params" :key="param.id" >
                        <td style="padding:10px;margin:10px">
                            [[param.name]]<span v-if="param.required">&nbsp;<b>*</b></span>&nbsp;
                        </td>
                        <td>
                            <span v-if="param.type == 'String'">
                                <input type="text" :placeholder="param.hint" v-model="param.string_value" size="60" @keyup.enter="$('#paramsSubmit').click()">
                            </span>
                            <span v-else-if="param.type == 'Credential'">
                                <select v-model="param.credential_id" @change="select_main_credential(param)">
                                    <option value="0">Select One...</option>
                                    <option v-for="cred in credentials" :value="cred.id">
                                        <template v-if="cred.comment === ''">
                                            [[cred.account]]@[[cred.realm]] - [[cred.type]]
                                        </template>
                                        <template v-else>
                                            [[cred.comment]]
                                        </template>
                                    </option>
                                </select><br>
                                <select v-model="param.credential_value">
                                    <option value="" selected>Select One...</option>
                                    <option v-for="(key, field) in param.credential" :value="key">[[field]]: [[key.substring(0,20)]]</option>
                                </select>
                            </span>
                            <span v-else-if="param.type == 'Number'">
                                <input type="number" v-model="param.number_value" @keyup.enter="$('#paramsSubmit').click()">
                            </span>
                            <span v-else-if="param.type == 'Choice'">
                                <select v-model="param.choice_value">
                                    <option v-for="opt in param.choices.split('\n')" :value="opt">[[opt]]</option>
                                </select>
                            </span>
                            <span v-else-if="param.type == 'ChoiceMultiple'">
                                <select multiple v-model="param.choicemultiple_value">
                                    <option v-for="opt in param.choices.split('\n')" :value="opt">[[opt]]</option>
                                </select>
                            </span>
                            <span v-else-if="param.type == 'Boolean'">
                                &nbsp;<span class="material-switch pull-right"><input type="checkbox" v-model="param.boolean_value" :id="'param' + param.id">
                                <label :for="'param' + param.id" class="btn-info"></label></span>
                            </span>
                            <span v-else-if="param.type == 'Array'">
                                <div v-for="(arg, index) in param.array_value" :key="index">
                                    <span class="input-group">
                                        <button class="btn btn{{config['outline-buttons']}}danger btn-sm" @click="command_params_remove_array_element(param, index)"><i class="fas fa-trash-alt" ></i></button>
                                        <textarea v-model="param.array_value[index]" rows="1" cols="60" @input="split_input_params(param, index)"></textarea>
                                    </span>
                                </div>
                                <button class="btn btn{{config['outline-buttons']}}success btn-sm" @click="command_params_add_array_element(param);"><i class="fas fa-plus"></i> </button>
                            </span>
                            <span v-else-if="param.type == 'File'">
                                <input type="file" :id="'fileparam' + param.name">
                            </span>
                        </td>
                    </tr>
                </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="paramsSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODAL FOR PROMPTING FOR COMMAND PARAMETERS -->
<!-- THIS IS OUR MODEL FOR EDITING DESCRIPTION -->
<div class="modal fade" id="editDescriptionModal" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Edit Description</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body">
                  <input class="text" size="60" id="editDescriptionText" @keyup.enter="$('#editDescriptionSubmit').click()">
              </div>
            <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}primary" data-dismiss="modal" id="editDescriptionSubmit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODEL FOR EDITING DESCRIPTION -->
<!-- THIS IS OUR MODEL FOR ISSUING MASS TASKING -->
<div class="modal fade" id="group_modify" role="dialog">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h3>Are you sure?</h3>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
              <div class="modal-body">
                  You will apply this action to the following selected callbacks:<br>
                  [[callbacks.join(', ')]]
              </div>
            <div class="modal-footer">
                <button class="btn btn{{config['outline-buttons']}}warning" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn{{config['outline-buttons']}}danger" data-dismiss="modal" id="group_modify_submit">Submit</button>
              </div>
        </div>
    </div>
</div>
<!-- END MODEL FOR ISSUING MASS TASKING -->
{% endblock %}

{% block scripts %}
{% include "callbacks.js" %}
{% endblock %}

{% block body_config %}
.has-children{

}
.is-callback{
    background-color: {{config['highlight']}};
    color: {{config['highlight-text']}};
}
.label-wrapper{
    border-left: 2px solid grey;
}}
{% endblock %}